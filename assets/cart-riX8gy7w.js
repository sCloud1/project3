import{v as y,k as g,y as n}from"./index-A1qbNCIE.js";import{r as o,u as A,E as u}from"./user-GNF1uiWY.js";const b=({skuId:s,count:a})=>o.post("/member/cart",{skuId:s,count:a}),w=()=>o.get("/member/cart"),D=s=>o.delete("/member/cart",{data:{ids:s}}),x=s=>o.post("/member/cart/merge",s),S=({skuId:s,selected:a,count:c})=>o.put(`/member/cart/${s}`,{selected:a,count:c}),T=(s,a)=>o.put("/member/cart/selected",{selected:s,ids:a}),U=y("cart",()=>{const s=A(),a=g([]),c=async()=>{const e=await w();a.value=e.data.result},d=async e=>{if(s.token)await b({skuId:e.skuId,count:e.count}),c();else{const t=a.value.find(r=>r.skuId===e.skuId);t?t.count+=e.count:a.value.push(e)}},i=async e=>{if(s.token)await D([e]),c(),u({type:"success",message:"删除成功",duration:1e3});else{const t=a.value.findIndex(r=>r.skuId===e);a.value.splice(t,1),u({type:"success",message:"删除成功",duration:1e3})}},p=async e=>{s.token?(await T(e,a.value.map(t=>t.skuId)),c()):a.value.forEach(t=>t.selected=e)},m=n(()=>a.value.every(e=>e.selected)),v=n(()=>a.value.reduce((e,t)=>e+t.count,0)),f=n(()=>a.value.reduce((e,t)=>e+t.count*t.price,0).toFixed(2)),C=n(()=>a.value.reduce((e,t)=>t.selected?e+t.count:e,0)),k=n(()=>a.value.reduce((e,t)=>t.selected?e+t.count*t.price:e,0).toFixed(2));return{cartList:a,isAll:m,goodTotal:v,goodTotalPrice:f,selectedGoodTotal:C,selectedGoodTotalPrice:k,addCart:d,delCart:i,allCheck:p,alterCartInfo:async({skuId:e,selected:t,count:r})=>{if(s.token)await S({skuId:e,selected:t,count:r}),c();else{const l=a.value.find(I=>I.skuId===e);l.count=r,l.selected=t}},getCartData:c,mergeCartData:async()=>{await x(a.value.map(e=>({skuId:e.skuId,selected:e.selected,count:e.count}))),c()},clearCart:()=>{a.value=[]}}},{persist:!0});export{U as u};
